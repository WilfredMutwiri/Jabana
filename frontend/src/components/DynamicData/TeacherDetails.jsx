import { useState,useEffect } from "react";
import { useParams } from "react-router-dom";
import {SERVER_URL} from '../../constants/SERVER_URL';
import logo from '../../assets/schoolLogo.webp';
import { Spinner } from "../spinner";
import {Button} from "flowbite-react";
import {jsPDF} from "jspdf";
import "jspdf-autotable";


const TeacherDetails=()=>{
    const {id}=useParams();
    const [teacher,setTeacher]=useState(null);
    const [loading,setIsLoading]=useState(true);
    const [error,setError]=useState(null);

    // download teacher data
    const downloadPDF=()=>{
        const doc=new jsPDF();
        doc.setFillColor(255,255,255);
        //header
        doc.setFontSize(18);
        doc.setFont("helvetica","bold");
        doc.text("DESTINYKERS HIGH SCHOOL",105,15,{align:"center"});

        doc.setFontSize(14);
        doc.setFont("helvetica","bold");
        doc.text("Teacher's Demographic Details",105,25,{align:"center"});
        doc.setDrawColor(150,150,150);
        doc.line(10,30,300,30);
        //content
        doc.setFontSize(12);
        doc.setFont("helvetica","normal");
        doc.text(`Name :`,10,40);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.fullName}`,40,40);

        doc.setFont("helvetica","normal");
        doc.text(`Email :`,10,50);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.email}`,40,50);

        doc.setFont("helvetica","normal");
        doc.text(`Phone No:`,10,60);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.phoneNo}`,40,60);

        doc.setFont("helvetica","normal");
        doc.text(`Sex:`,10,70);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.sex}`,40,70);

        doc.setFont("helvetica","normal");
        doc.text(`Nationality:`,10,80);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.nationality}`,40,80);

        doc.setFont("helvetica","normal");
        doc.text(`National Id:`,10,90);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.nationalId}`,40,90);

        doc.setFont("helvetica","normal");
        doc.text(`Place of Birth:`,10,100);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.placeOfBirth}`,40,100);

        doc.setFont("helvetica","normal");
        doc.text(`Box Office:`,10,110);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.boxOffice}`,40,110);

        doc.setFont("helvetica","normal");
        doc.text(`Marital Status:`,10,120);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.maritalStatus}`,40,120);

        doc.setFont("helvetica","normal");
        doc.text(`Religion:`,10,130);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.religion}`,40,130);

        doc.setFont("helvetica","normal");
        doc.text(`Role:`,10,140);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.Role}`,40,140);

        doc.setFont("helvetica","normal");
        doc.text(`Employer:`,10,150);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.Employer}`,40,150);

        doc.setFont("helvetica","normal");
        doc.text(`Date of Birth:`,10,160);
        doc.setFont("helvetica","bold");
        doc.text(`${teacher.createdAt}`,40,160);
        //footer
        doc.setFontSize(10);
        doc.setDrawColor(150,150,150);
        doc.line(10,30,300,30);
        doc.text(`Generated by SchoolSync | @ ${new Date().getFullYear()}`,105,290,{align:'center'});
        //save pdf
        doc.save(`${teacher.fullName}_demographic_Details.pdf`);
    }

    useEffect(()=>{
        const fetchTeacherDetails=async()=>{
            try {
                const res=await fetch(`${SERVER_URL}/api/users/teacher/${id}`);
                const data=await res.json();

                if(res.ok){
                    setTeacher(data);
                }else{
                    throw new Error(data.message || "Error fetching teacher info");
                }
            } catch (error) {
                setError(error.message)
            }finally{
                setIsLoading(false);
            };
        };
        fetchTeacherDetails();
    },[id])

    if(loading) return (
        <div className="  w-80 mx-auto flex gap-4">
        <p>{<Spinner/>}</p>
        <p className="my-auto font-semibold text-cyan-700">Loading teacher's details...</p>
        </div>
    )
    if(error) return <p className="text-red-600 text-center font-semibold">Error fetching teacher's details!</p>

    return(
        <div>

            <div className="w-11/12 mx-auto bg-white">
            <div className="flex justify-center border border-cyan-300">
                <img src={logo} className="w-24 h-24"/>
                <h2 className="text-2xl font-semibold my-auto text-cyan-800">DESTINYKERS HIGH SCHOOL</h2>
            </div>
            <div>
            <p className="text-center font-semibold text-gray-900 mt-4">Teacher Demography</p>
            <div className="flex justify-between p-3 gap-6 w-10/12 mx-auto mt-4">
            <div>
            <ul className="flex flex-col gap-4">
                    <li>Full Name: <span className="demographyLi">{teacher.fullName}</span></li>
                    <li>Email: <span className="demographyLi">{teacher.email}</span></li>
                    <li>Mobile No: <span className="demographyLi">{teacher.phoneNo}</span></li>
                    <li>Sex: <span className="demographyLi">{teacher.sex}</span></li>
                    <li>National Id No: <span className="demographyLi">{teacher.nationalId}</span></li>
                </ul>
            </div>
            <div>
            <ul className="flex flex-col gap-4">
                <li>Title : <span className="demographyLi">{teacher.title}</span></li>
                <li>Birth Date: <span className="demographyLi">{teacher.createdAt}</span></li>
                <li>Place Of Birth: <span className="demographyLi">{teacher.placeOfBirth}</span></li>
                <li>Current Address : <span className="demographyLi">{teacher.boxOffice}</span></li>
                <li>Nationality: <span className="demographyLi">{teacher.nationality}</span></li>
            </ul>
            </div>
            <div>
            <ul className="flex flex-col gap-4">
                <li>Marital Status: <span className="demographyLi">{teacher.maritalStatus}</span></li>
                <li>Religion: <span className="demographyLi">{teacher.religion}</span></li>
                <li>Role : <span className="demographyLi">{teacher.Role}</span></li>
                <li>Class In Charge: <span className="demographyLi">{teacher.classInCharge}</span></li>
                <li>Employer: <span className="demographyLi">{teacher.Employer}</span></li>
            </ul>
            </div>
            </div>
            <div className="w-10/12 mx-auto pt-4 flex gap-6">
                <Button onClick={()=>(downloadPDF())}>Download</Button>
                <Button>Update</Button>
                <Button className="bg-red-700">Delete</Button>
            </div>
            </div>
            </div>
        </div>
    )
}

export default TeacherDetails;
